<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fusion Music Player - Enhanced Debug Console</title>
    <style>
        body { 
            font-family: 'MS Sans Serif', 'Tahoma', sans-serif; 
            background: #c0c0c0; 
            color: #000000; 
            padding: 20px;
            margin: 0;
            line-height: 1.4;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            border: 2px inset #c0c0c0;
            padding: 20px;
            background: #c0c0c0;
        }
        
        .header h1 {
            margin: 0;
            color: #000080;
            font-family: 'MS Sans Serif', sans-serif;
            font-size: 18px;
        }
        
        .header .version {
            color: #000000;
            margin-top: 5px;
            font-size: 11px;
        }
        
        .section {
            margin-bottom: 20px;
            border: 2px outset #c0c0c0;
            padding: 15px;
            background: #c0c0c0;
        }
        
        .section h2 {
            margin-top: 0;
            color: #000080;
            font-size: 14px;
            font-weight: bold;
            border-bottom: 1px solid #808080;
            padding-bottom: 5px;
            font-family: 'MS Sans Serif', sans-serif;
        }
        
        .test { 
            margin: 4px 0; 
            padding: 4px 8px; 
            border: 1px inset #c0c0c0;
            background: #ffffff;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 11px;
        }
        
        .test-name {
            font-weight: normal;
            min-width: 180px;
            font-family: 'MS Sans Serif', sans-serif;
        }
        
        .test-status {
            padding: 1px 4px;
            font-size: 10px;
            font-weight: bold;
            font-family: 'MS Sans Serif', sans-serif;
        }
        
        .pass { 
            color: #000080;
        }
        
        .pass .test-status {
            background: #008000;
            color: #ffffff;
        }
        
        .fail { 
            color: #800000;
        }
        
        .fail .test-status {
            background: #ff0000;
            color: #ffffff;
        }
        
        .warn { 
            color: #808000;
        }
        
        .warn .test-status {
            background: #ffff00;
            color: #000000;
        }
        
        .test-message {
            flex-grow: 1;
            font-size: 11px;
        }
        
        .controls {
            display: flex;
            gap: 6px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        button {
            background: #c0c0c0;
            border: 2px outset #c0c0c0;
            color: #000000;
            padding: 4px 12px;
            margin: 2px;
            cursor: pointer;
            font-family: 'MS Sans Serif', sans-serif;
            font-size: 11px;
            min-height: 23px;
        }
        
        button:hover { 
            background: #d4d0c8; 
        }
        
        button:active {
            border: 2px inset #c0c0c0;
        }
        
        button:disabled {
            color: #808080;
            cursor: default;
        }
        
        .library-status {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 8px;
            margin-top: 10px;
        }
        
        .lib-item {
            padding: 4px;
            border: 1px inset #c0c0c0;
            background: #ffffff;
            font-size: 10px;
            font-family: 'MS Sans Serif', sans-serif;
        }
        
        .results-container {
            max-height: 350px;
            overflow-y: auto;
            border: 2px inset #c0c0c0;
            padding: 8px;
            background: #ffffff;
        }
        
        .performance-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 8px;
            margin-top: 10px;
        }
        
        .metric {
            padding: 8px;
            border: 1px outset #c0c0c0;
            background: #c0c0c0;
            text-align: center;
            font-family: 'MS Sans Serif', sans-serif;
        }
        
        .metric-value {
            font-size: 12px;
            font-weight: bold;
            color: #000080;
        }
        
        .metric-label {
            font-size: 9px;
            color: #000000;
        }
        
        .log-container {
            background: #000000;
            border: 2px inset #c0c0c0;
            padding: 8px;
            max-height: 180px;
            overflow-y: auto;
            font-size: 10px;
            font-family: 'Courier New', monospace;
            color: #ffffff;
        }
        
        .log-entry {
            margin: 1px 0;
            padding: 1px 0;
        }
        
        .log-error { color: #ff8080; }
        .log-warn { color: #ffff80; }
        .log-info { color: #80ff80; }
        .log-debug { color: #808080; }
        
        .auto-refresh {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #c0c0c0;
            border: 2px outset #c0c0c0;
            padding: 8px;
            font-family: 'MS Sans Serif', sans-serif;
            font-size: 10px;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.3; }
        }
        
        .blinking {
            animation: blink 1s infinite;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üíª FUSION MUSIC PLAYER DEBUG CONSOLE</h1>
        <div class="version">Enhanced Debug Suite v2.0 :: Phase 2 Testing :: Windows 98 Style</div>
    </div>
    
    <div class="auto-refresh">
        <label>
            <input type="checkbox" id="autoRefresh" checked>
            Auto-refresh (5s)
        </label>
        <div style="font-size: 10px; margin-top: 5px;">
            Last update: <span id="lastUpdate">-</span>
        </div>
    </div>
    
    <div class="section">
        <h2>‚ö° Quick Actions</h2>
        <div class="controls">
            <button onclick="runAllTests()">üìã Run All Tests</button>
            <button onclick="runAudioTests()">üîä Audio Tests</button>
            <button onclick="runLibraryTests()">üìÅ Library Tests</button>
            <button onclick="runPerformanceTests()">üìä Performance Tests</button>
            <button onclick="runDiagnostics()">üîß Full Diagnostics</button>
            <button onclick="clearResults()">üóë Clear Results</button>
            <button onclick="exportResults()">üíæ Export Results</button>
            <button onclick="testAudioPlayback()">‚ñ∂ Test Playback</button>
        </div>
    </div>
    
    <div class="section">
        <h2>üíª System Status</h2>
        <div id="systemOverview"></div>
        <div class="performance-metrics" id="performanceMetrics"></div>
    </div>
    
    <div class="section">
        <h2>üìÅ Library Status</h2>
        <div class="library-status" id="libraryStatus"></div>
    </div>
    
    <div class="section">
        <h2>üß™ Test Results</h2>
        <div class="results-container" id="results"></div>
    </div>
    
    <div class="section">
        <h2>üìÑ Console Log</h2>
        <div class="log-container" id="consoleLog"></div>
    </div>

    <!-- Load libraries in same order as main app -->
    <script src="/js/libopenmpt.js" onerror="logError('OpenMPT library failed to load')"></script>
    <script src="/js/chiptune2.js" onerror="logError('Chiptune2 library failed to load')"></script>
    <script src="/js/libfluidsynth-2.3.0.js" onerror="logError('FluidSynth library failed to load')"></script>
    <script src="/js/js-synthesizer.js" onerror="logError('JS-Synthesizer library failed to load')"></script>
    <script src="/js/webaudio-tinysynth.js" onerror="logError('WebAudio TinySynth library failed to load')"></script>
    <script src="/js/midi-parser.js" onerror="logError('MIDI Parser library failed to load')"></script>
    <script src="/js/fallback-audio-engine.js" onerror="logError('Fallback Audio Engine failed to load')"></script>
    <script src="/js/audio-engine.js" onerror="logError('Audio Engine failed to load')"></script>
    <script src="/js/ui-controller.js" onerror="logError('UI Controller failed to load')"></script>
    
    <script>
        // Enhanced debug console with comprehensive testing
        let testResults = [];
        let consoleLog = [];
        let audioEngine = null;
        let uiController = null;
        let startTime = performance.now();
        
        // Capture console output
        const originalConsole = {
            log: console.log,
            warn: console.warn,
            error: console.error,
            info: console.info
        };
        
        function logError(message) {
            addConsoleEntry('error', message);
        }
        
        function addConsoleEntry(type, message) {
            const entry = {
                type: type,
                message: message,
                timestamp: new Date().toISOString(),
                time: performance.now() - startTime
            };
            
            consoleLog.push(entry);
            updateConsoleDisplay();
            
            // Keep only last 100 entries
            if (consoleLog.length > 100) {
                consoleLog = consoleLog.slice(-100);
            }
        }
        
        // Override console methods
        console.log = function(...args) {
            originalConsole.log(...args);
            addConsoleEntry('info', args.join(' '));
        };
        
        console.warn = function(...args) {
            originalConsole.warn(...args);
            addConsoleEntry('warn', args.join(' '));
        };
        
        console.error = function(...args) {
            originalConsole.error(...args);
            addConsoleEntry('error', args.join(' '));
        };
        
        function addResult(test, status, message, details = null) {
            const result = {
                test: test,
                status: status,
                message: message,
                details: details,
                timestamp: new Date().toISOString(),
                time: (performance.now() - startTime).toFixed(2)
            };
            
            testResults.push(result);
            updateResultsDisplay();
            
            const div = document.createElement('div');
            div.className = `test ${status}`;
            div.innerHTML = `
                <div class="test-name">${test}</div>
                <div class="test-status">${status.toUpperCase()}</div>
                <div class="test-message">${message}</div>
            `;
            
            const resultsContainer = document.getElementById('results');
            resultsContainer.appendChild(div);
            
            // Auto-scroll to bottom
            resultsContainer.scrollTop = resultsContainer.scrollHeight;
        }
        
        function checkLibrary(name, checkFunction) {
            try {
                const result = checkFunction();
                if (result) {
                    addResult(`üìÇ Library: ${name}`, 'pass', 'Available and functional');
                    return true;
                } else {
                    addResult(`üìÇ Library: ${name}`, 'fail', 'Not available or not functional');
                    return false;
                }
            } catch (error) {
                addResult(`üìÇ Library: ${name}`, 'fail', `Error: ${error.message}`);
                return false;
            }
        }
        
        async function runAllTests() {
            clearResults();
            addResult('Test Suite', 'info', 'Starting comprehensive test suite...');
            
            const startTime = performance.now();
            
            try {
                await runBasicTests();
                await runAudioTests();
                await runLibraryTests();
                await runAPITests();
                await runPerformanceTests();
                
                const duration = (performance.now() - startTime).toFixed(2);
                addResult('Test Suite', 'pass', `All tests completed in ${duration}ms`);
                
            } catch (error) {
                addResult('Test Suite', 'fail', `Test suite failed: ${error.message}`);
            }
        }
        
        async function runBasicTests() {
            addResult('üíª Basic Tests', 'info', 'Running basic environment tests...');
            
            // Browser detection
            const ua = navigator.userAgent;
            let browser = 'Unknown';
            if (ua.includes('Chrome/')) browser = 'Chrome ' + ua.match(/Chrome\/(\d+)/)[1];
            else if (ua.includes('Firefox/')) browser = 'Firefox ' + ua.match(/Firefox\/(\d+)/)[1];
            else if (ua.includes('Safari/') && !ua.includes('Chrome')) browser = 'Safari';
            else if (ua.includes('Edge/')) browser = 'Edge';
            
            addResult('üåê Browser Detection', 'pass', browser);
            
            // JavaScript features
            addResult('‚öô ES6 Support', typeof Promise !== 'undefined' ? 'pass' : 'fail', 
                     typeof Promise !== 'undefined' ? 'Promise support available' : 'No Promise support');
            
            addResult('üì° Fetch API', typeof fetch !== 'undefined' ? 'pass' : 'fail',
                     typeof fetch !== 'undefined' ? 'Fetch API available' : 'Fetch API not available');
            
            // Web Audio API
            const AudioContext = window.AudioContext || window.webkitAudioContext;
            if (AudioContext) {
                addResult('üîä Web Audio API', 'pass', 'Supported');
                
                // Test AudioWorklet support
                if (AudioContext.prototype.audioWorklet) {
                    addResult('‚ö° AudioWorklet Support', 'pass', 'Supported');
                } else {
                    addResult('‚ö° AudioWorklet Support', 'fail', 'Not supported in this browser');
                }
                
                // Test Web Audio features
                try {
                    const tempContext = new AudioContext();
                    addResult('üéõ AudioContext Creation', 'pass', `Sample rate: ${tempContext.sampleRate}Hz`);
                    
                    if (tempContext.audioWorklet) {
                        addResult('‚ö° AudioWorklet Available', 'pass', 'AudioWorklet interface available');
                    } else {
                        addResult('‚ö° AudioWorklet Available', 'fail', 'AudioWorklet not available');
                    }
                    
                    tempContext.close();
                } catch (error) {
                    addResult('üéõ AudioContext Creation', 'fail', error.message);
                }
            } else {
                addResult('üîä Web Audio API', 'fail', 'Not supported');
            }
            
            // WebAssembly
            addResult('üîß WebAssembly Support', typeof WebAssembly !== 'undefined' ? 'pass' : 'fail',
                     typeof WebAssembly !== 'undefined' ? 'WebAssembly available' : 'WebAssembly not available');
        }
        
        async function runAudioTests() {
            addResult('Audio Tests', 'info', 'Running audio system tests...');
            
            try {
                // Test audio context creation and setup
                const AudioContext = window.AudioContext || window.webkitAudioContext;
                const testContext = new AudioContext();
                
                addResult('Audio Context State', 'pass', `Initial state: ${testContext.state}`);
                
                // Test basic audio nodes
                const gainNode = testContext.createGain();
                const oscillator = testContext.createOscillator();
                
                addResult('Audio Nodes', 'pass', 'GainNode and OscillatorNode created successfully');
                
                // Test audio context resume (user activation required)
                if (testContext.state === 'suspended') {
                    addResult('Audio Context', 'warn', 'Context suspended - user interaction required');
                } else {
                    addResult('Audio Context', 'pass', 'Context running');
                }
                
                // Test AudioWorklet if available
                if (testContext.audioWorklet) {
                    try {
                        await testContext.audioWorklet.addModule('/js/audio-worklet-processor.js');
                        addResult('AudioWorklet Module', 'pass', 'Audio worklet processor loaded successfully');
                        
                        const workletNode = new AudioWorkletNode(testContext, 'fusion-audio-processor');
                        addResult('AudioWorklet Node', 'pass', 'AudioWorkletNode created successfully');
                        
                        workletNode.disconnect();
                    } catch (error) {
                        addResult('AudioWorklet Module', 'fail', `Failed to load: ${error.message}`);
                    }
                }
                
                testContext.close();
                
            } catch (error) {
                addResult('Audio Tests', 'fail', `Audio test failed: ${error.message}`);
            }
        }
        
        async function runLibraryTests() {
            addResult('Library Tests', 'info', 'Testing audio library availability...');
            
            // Wait a bit for libraries to load
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            // Test core application classes
            addResult('AudioEngine class', typeof AudioEngine !== 'undefined' ? 'pass' : 'fail', 
                     typeof AudioEngine !== 'undefined' ? 'Loaded' : 'Missing audio-engine.js');
            
            addResult('UIController class', typeof UIController !== 'undefined' ? 'pass' : 'fail', 
                     typeof UIController !== 'undefined' ? 'Loaded' : 'Missing ui-controller.js');
            
            addResult('FallbackAudioEngine class', typeof FallbackAudioEngine !== 'undefined' ? 'pass' : 'fail', 
                     typeof FallbackAudioEngine !== 'undefined' ? 'Loaded' : 'Missing fallback-audio-engine.js');
            
            // Test audio libraries
            checkLibrary('OpenMPT Module', () => typeof Module !== 'undefined');
            checkLibrary('ChiptuneJS Config', () => typeof ChiptuneJsConfig !== 'undefined');
            checkLibrary('ChiptuneJS Player', () => typeof ChiptuneJsPlayer !== 'undefined');
            checkLibrary('JSSynth', () => typeof JSSynth !== 'undefined');
            checkLibrary('WebAudioTinySynth', () => typeof WebAudioTinySynth !== 'undefined');
            checkLibrary('LibFluidSynth', () => typeof LibFluidSynth !== 'undefined');
            checkLibrary('MidiParser', () => typeof MidiParser !== 'undefined');
        }
        
        async function runAPITests() {
            addResult('API Tests', 'info', 'Testing server API endpoints...');
            
            try {
                // Test music files endpoint
                const filesResponse = await fetch('/api/music-files');
                if (filesResponse.ok) {
                    const files = await filesResponse.json();
                    addResult('Music Files API', 'pass', `Found ${files.length} files`);
                    
                    if (files.length > 0) {
                        const firstFile = files[0];
                        addResult('Sample File', 'pass', `${firstFile.filename} (${firstFile.displaySize || 'unknown size'})`);
                        
                        // Test file access
                        const fileResponse = await fetch(`/music/${firstFile.filename}`, { method: 'HEAD' });
                        if (fileResponse.ok) {
                            addResult('File Access', 'pass', `Can access ${firstFile.filename}`);
                        } else {
                            addResult('File Access', 'fail', `Cannot access ${firstFile.filename}: HTTP ${fileResponse.status}`);
                        }
                    } else {
                        addResult('File Access Test', 'warn', 'No files available for testing');
                    }
                } else {
                    addResult('Music Files API', 'fail', `HTTP ${filesResponse.status}: ${filesResponse.statusText}`);
                }
                
                // Test SoundFont access
                const sfResponse = await fetch('/soundfonts/default.sf2', { method: 'HEAD' });
                if (sfResponse.ok) {
                    addResult('SoundFont Access', 'pass', `Default SoundFont available (${sfResponse.headers.get('content-length')} bytes)`);
                } else {
                    addResult('SoundFont Access', 'warn', 'Default SoundFont not found - MIDI playback may use built-in sounds');
                }
                
            } catch (error) {
                addResult('API Tests', 'fail', `API test failed: ${error.message}`);
            }
        }
        
        async function runPerformanceTests() {
            addResult('Performance Tests', 'info', 'Running performance benchmarks...');
            
            try {
                // Memory usage
                if (performance.memory) {
                    const memory = performance.memory;
                    addResult('Memory Usage', 'pass', 
                        `Used: ${(memory.usedJSHeapSize/1024/1024).toFixed(2)}MB, ` +
                        `Total: ${(memory.totalJSHeapSize/1024/1024).toFixed(2)}MB`);
                }
                
                // Timing API
                if (performance.now) {
                    const start = performance.now();
                    await new Promise(resolve => setTimeout(resolve, 10));
                    const end = performance.now();
                    addResult('High Resolution Timing', 'pass', `Precision: ${(end - start).toFixed(3)}ms`);
                }
                
                // Test AudioContext latency if available
                try {
                    const testContext = new (window.AudioContext || window.webkitAudioContext)();
                    if (testContext.baseLatency !== undefined) {
                        addResult('Audio Latency', 'pass', 
                            `Base: ${(testContext.baseLatency * 1000).toFixed(2)}ms, ` +
                            `Output: ${testContext.outputLatency ? (testContext.outputLatency * 1000).toFixed(2) + 'ms' : 'N/A'}`);
                    }
                    testContext.close();
                } catch (error) {
                    addResult('Audio Latency', 'warn', 'Could not measure audio latency');
                }
                
            } catch (error) {
                addResult('Performance Tests', 'fail', `Performance test failed: ${error.message}`);
            }
        }
        
        async function runDiagnostics() {
            clearResults();
            addResult('Diagnostics', 'info', 'Running comprehensive system diagnostics...');
            
            try {
                // Initialize audio engine for testing
                if (typeof AudioEngine !== 'undefined') {
                    audioEngine = new AudioEngine();
                    await audioEngine.initialize();
                    
                    const diagnostics = await audioEngine.runDiagnostics();
                    addResult('Audio Engine Diagnostics', 'pass', 'Diagnostics completed - check console for details');
                }
                
                // Initialize UI controller for testing
                if (typeof UIController !== 'undefined') {
                    uiController = new UIController();
                    await uiController.initialize();
                    
                    const uiDiagnostics = uiController.runDiagnostics();
                    addResult('UI Controller Diagnostics', 'pass', 'UI diagnostics completed - check console for details');
                }
                
                updateSystemOverview();
                
            } catch (error) {
                addResult('Diagnostics', 'fail', `Diagnostics failed: ${error.message}`);
            }
        }
        
        async function testAudioPlayback() {
            if (!audioEngine) {
                addResult('Playback Test', 'fail', 'Audio engine not initialized - run diagnostics first');
                return;
            }
            
            try {
                addResult('Playback Test', 'info', 'Testing audio playback...');
                
                // Get available files
                const response = await fetch('/api/music-files');
                const files = await response.json();
                
                if (files.length === 0) {
                    addResult('Playback Test', 'warn', 'No music files available for testing');
                    return;
                }
                
                const testFile = files[0];
                addResult('Playback Test', 'info', `Testing with: ${testFile.filename}`);
                
                await audioEngine.playTrack(testFile);
                
                // Stop playback after 2 seconds
                setTimeout(() => {
                    if (audioEngine) {
                        audioEngine.stop();
                        addResult('Playback Test', 'pass', 'Playback test completed successfully');
                    }
                }, 2000);
                
            } catch (error) {
                addResult('Playback Test', 'fail', `Playback test failed: ${error.message}`);
            }
        }
        
        function clearResults() {
            testResults = [];
            document.getElementById('results').innerHTML = '';
        }
        
        function exportResults() {
            const data = {
                timestamp: new Date().toISOString(),
                userAgent: navigator.userAgent,
                testResults: testResults,
                consoleLog: consoleLog,
                performanceMetrics: getPerformanceMetrics()
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `fusion-debug-${new Date().toISOString().slice(0,19).replace(/:/g,'-')}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            addResult('Export', 'pass', 'Debug results exported successfully');
        }
        
        function updateLibraryStatus() {
            const status = document.getElementById('libraryStatus');
            const libs = {
                'OpenMPT Module': typeof Module !== 'undefined',
                'ChiptuneJS Config': typeof ChiptuneJsConfig !== 'undefined',
                'ChiptuneJS Player': typeof ChiptuneJsPlayer !== 'undefined',
                'JSSynth': typeof JSSynth !== 'undefined',
                'WebAudioTinySynth': typeof WebAudioTinySynth !== 'undefined',
                'LibFluidSynth': typeof LibFluidSynth !== 'undefined',
                'AudioEngine': typeof AudioEngine !== 'undefined',
                'UIController': typeof UIController !== 'undefined',
                'FallbackAudioEngine': typeof FallbackAudioEngine !== 'undefined',
                'MidiParser': typeof MidiParser !== 'undefined'
            };
            
            status.innerHTML = Object.entries(libs)
                .map(([name, loaded]) => 
                    `<div class="lib-item" style="color: ${loaded ? '#000080' : '#800000'}">
                        ${loaded ? '‚úì' : '‚úó'} ${name}
                    </div>`
                )
                .join('');
        }
        
        function updateSystemOverview() {
            const overview = document.getElementById('systemOverview');
            const AudioContext = window.AudioContext || window.webkitAudioContext;
            
            const info = {
                'Browser': navigator.userAgent.split(' ').pop(),
                'Audio API': AudioContext ? '‚úì' : '‚úó',
                'AudioWorklet': AudioContext && AudioContext.prototype.audioWorklet ? '‚úì' : '‚úó',
                'WebAssembly': typeof WebAssembly !== 'undefined' ? '‚úì' : '‚úó',
                'Libraries Loaded': Object.keys(window).filter(key => 
                    ['Module', 'ChiptuneJsConfig', 'JSSynth', 'WebAudioTinySynth', 'LibFluidSynth', 'AudioEngine', 'UIController'].includes(key)
                ).length,
                'Test Results': testResults.length,
                'Console Entries': consoleLog.length
            };
            
            overview.innerHTML = Object.entries(info)
                .map(([key, value]) => `<strong>${key}:</strong> ${value}`)
                .join(' | ');
        }
        
        function updatePerformanceMetrics() {
            const metrics = document.getElementById('performanceMetrics');
            const data = getPerformanceMetrics();
            
            metrics.innerHTML = Object.entries(data)
                .map(([key, value]) => 
                    `<div class="metric">
                        <div class="metric-value">${value}</div>
                        <div class="metric-label">${key}</div>
                    </div>`
                )
                .join('');
        }
        
        function getPerformanceMetrics() {
            return {
                'Uptime': `${((performance.now() - startTime) / 1000).toFixed(1)}s`,
                'Memory': performance.memory ? `${(performance.memory.usedJSHeapSize/1024/1024).toFixed(1)}MB` : 'N/A',
                'Tests': testResults.length,
                'Errors': consoleLog.filter(entry => entry.type === 'error').length
            };
        }
        
        function updateConsoleDisplay() {
            const logContainer = document.getElementById('consoleLog');
            logContainer.innerHTML = consoleLog.slice(-20).map(entry => 
                `<div class="log-entry log-${entry.type}">
                    [${new Date(entry.timestamp).toLocaleTimeString()}] ${entry.message}
                </div>`
            ).join('');
            
            logContainer.scrollTop = logContainer.scrollHeight;
        }
        
        function updateResultsDisplay() {
            // Update last update timestamp
            document.getElementById('lastUpdate').textContent = new Date().toLocaleTimeString();
        }
        
        // Auto-refresh functionality
        function setupAutoRefresh() {
            const checkbox = document.getElementById('autoRefresh');
            
            setInterval(() => {
                if (checkbox.checked) {
                    updateLibraryStatus();
                    updateSystemOverview();
                    updatePerformanceMetrics();
                    updateResultsDisplay();
                }
            }, 5000);
        }
        
        // Initialize on page load
        window.addEventListener('load', () => {
            setupAutoRefresh();
            
            setTimeout(() => {
                updateLibraryStatus();
                updateSystemOverview();
                updatePerformanceMetrics();
                
                // Run initial basic tests
                runBasicTests();
            }, 1000);
        });
        
        // Add some helpful keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey || e.metaKey) {
                switch (e.key) {
                    case 'r':
                        e.preventDefault();
                        runAllTests();
                        break;
                    case 's':
                        e.preventDefault();
                        exportResults();
                        break;
                    case 'c':
                        e.preventDefault();
                        clearResults();
                        break;
                }
            }
        });
        
        console.log('üíª Enhanced Debug Console v2.0 loaded (Windows 98 Style)');
        console.log('‚å® Keyboard shortcuts: Ctrl+R (run tests), Ctrl+S (export), Ctrl+C (clear)');
    </script>
</body>
</html>
